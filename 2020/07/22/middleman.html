<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>middlemanとgithubの連携</title>
    <link href="https://xuejoule.github.io/tanaka_blog/stylesheets/site-a77c873c.css" rel="stylesheet" />
    <script src="https://xuejoule.github.io/tanaka_blog/javascripts/site-954757c2.js"></script>
  </head>
  <body>
    <h1>middlemanとgithubの連携</h1>

<h1>github</h1>

<h1><a href="https://github.com/xuejoule/tanaka_blog.git">https://github.com/xuejoule/tanaka_blog.git</a></h1>

<p>参考url
<a href="https://zacky1972.github.io/tech/2017/11/04/middleman.html">https://zacky1972.github.io/tech/2017/11/04/middleman.html</a></p>

<h1>middlemanのインストール</h1>

<pre><code>manabu@jacquard|2020-07-20|22:46:27|/home/manabu/Desktop/development|
% gem install middleman
Successfully installed middleman-4.3.7
Parsing documentation for middleman-4.3.7
Done installing documentation for middleman after 0 seconds
1 gem installed
</code></pre>

<p>% middleman version
Middleman 5.0.0.rc.1</p>

<p>% middleman init tanaka_blog</p>

<p>% cd tanaka_blog</p>

<p>manabu@jacquard|2020-07-20|22:49:02|/home/manabu/Desktop/development/tanaka<em>blog|
% git init
Initialized empty Git repository in /home/manabu/Desktop/development/tanaka</em>blog/.git/</p>

<p>% git remote add origin (リモート先)
=&gt;% git remote add origin <a href="https://github.com/xuejoule/tanaka_blog.git">https://github.com/xuejoule/tanaka_blog.git</a></p>

<h1>ディレクトリの内容を add/commit/push する</h1>

<p>$ git add -A
$ git commit -m &quot;initial commit&quot;
$ git push -f origin master</p>

<h1>サーバ起動</h1>

<p>% bundle exec middleman server
ブラウザlocalhost:4567</p>

<p>manabu@jacquard|2020-07-20|22:53:59|/home/manabu/Desktop/development/tanaka<em>blog|
% vi Gemfile
manabu@jacquard|2020-07-20|22:53:59|/home/manabu/Desktop/development/tanaka</em>blog|
% cat Gemfile
gem &#39;middleman-blog&#39;, &#39;~&gt; 4.0&#39;
manabu@jacquard|2020-07-20|22:54:15|/home/manabu/Desktop/development/tanaka_blog|
% bundle install</p>

<h1>config.rb に次のような記述をする</h1>

<p>activate :blog do |blog|
  ブログ機能のオプションを設定
  blog.sources = &quot;{year}-{month}-{day}-{title}.html&quot;
  blog.permalink = &quot;{year}/{month}/{day}/{title}.html&quot;
  blog.default_extension = &quot;.md&quot;
end</p>

<p>helpers do
  def hostUrl link
    link
  end
end
※ hostUrl ヘルパーは後で使うフックとして用意しておきます。</p>

<p>source/index.html.erb に記述します。</p>

<h1>GitHub Flavored Markdown の導入</h1>

<p>Gemfile に下記を追加</p>

<p>gem &#39;redcarpet&#39;
gem &#39;nokogiri&#39;
下記のコマンドを実行します。</p>

<p>% bundle install</p>

<p>config.rb に下記を追加</p>

<h1>GitHub Flavored Markdown</h1>

<p>set :markdown, :tables =&gt; true, :autolink =&gt; true, :gh<em>blockcode =&gt; true, :fenced</em>code<em>blocks =&gt; true
set :markdown</em>engine, :redcarpet</p>

<p>GitHub Pages にデプロイ
gem &#39;middleman-deploy&#39;, &#39;~&gt; 2.0.0.pre.alpha&#39;
その後，次のコマンドを実行します。
% bundle install</p>

<p>config.rb に書いた hostUrl を次のように変更します。
helpers do
  def host_url(link)
    &#39;https://(ユーザー名).github.io&#39; + link =&gt; &#39;<a href="https://xuejoule.github.io">https://xuejoule.github.io</a>&#39; + link
    &#39;<a href="http://localhost:4567">http://localhost:4567</a>&#39; + link
  end
end</p>

<p>config.rb に下記の記述を追加
```</p>

<h1>Build-specific configuration</h1>

<p>configure :build do
  # Minify CSS on build
  # activate :minify_css</p>

<p># Minify Javascript on build
  # activate :minify<em>javascript
  # リポジトリ名を host に設定しておく
  # こうすることで stylesheet</em>link<em>tag などで展開されるパスが
  # https://(ユーザー名).github.io/(リポジトリ名)/stylesheets/*.css
  # のようになる
  activate :asset</em>hash
  activate :asset_host, :host =&gt; &#39;https://(ユーザー名).github.io&#39;=&gt;&#39;<a href="https://xuejoule.github.io">https://xuejoule.github.io</a>&#39;
end
```</p>

<h1>デプロイの設定</h1>

<h1>今回は gh-pages を使用するので branch に &#39;gh-pages&#39; を設定する</h1>

<p>activate :deploy do |deploy|
  deploy.build<em>before = true
  deploy.deploy</em>method = :git
  deploy.branch = &#39;gh-pages&#39;
end</p>

<p>以上の準備が終わったところで，次のコマンドを実行すると，GitHub Pages にデプロイされます。
manabu@jacquard|2020-07-20|23:34:00|/home/manabu/Desktop/development/tanaka<em>blog|
% bundle exec middleman deploy
Deprecation warning: Expected string default value for &#39;--instrument&#39;; got false (boolean).
This will be rejected in the future unless you explicitly pass the options `check</em>default<em>type: false<code>or call</code>allow</em>incompatible<em>default</em>type!<code>in your code
You can silence deprecations warning by setting the environment variable THOR_SILENCE_DEPRECATION.
== Blog Sources: {year}-{month}-{day}-{title}.html (:prefix + :sources)
         run  middleman build -e production from &quot;.&quot;
Deprecation warning: Expected string default value for &#39;--instrument&#39;; got false (boolean).
This will be rejected in the future unless you explicitly pass the options</code>check<em>default</em>type: false<code>or call</code>allow<em>incompatible</em>default<em>type!` in your code
You can silence deprecations warning by setting the environment variable THOR</em>SILENCE_DEPRECATION.
== Blog Sources: {year}-{month}-{day}-{title}.html (:prefix + :sources)
      create  build/stylesheets/site-a77c873c.css
      create  build/images/.keep
      create  build/javascripts/site-954757c2.js
      create  build/index.html
Project built successfully.</p>

<h2>Deploying via git to remote=&quot;origin&quot; and branch=&quot;gh-pages&quot;</h2>

<p>Can&#39;t deploy! Please add a remote with the name &#39;origin&#39; to your repo.</p>

<p>デプロイ失敗</p>

<p>===</p>

<p>% bundle exec middleman deploy
Deprecation warning: Expected string default value for &#39;--instrument&#39;; got false (boolean).
This will be rejected in the future unless you explicitly pass the options <code>check_default_type: false</code> or call <code>allow_incompatible_default_type!</code> in your code
You can silence deprecations warning by setting the environment variable THOR<em>SILENCE</em>DEPRECATION.
== Blog Sources: {year}-{month}-{day}-{title}.html (:prefix + :sources)
         run  middleman build -e production from &quot;.&quot;
Deprecation warning: Expected string default value for &#39;--instrument&#39;; got false (boolean).
This will be rejected in the future unless you explicitly pass the options <code>check_default_type: false</code> or call <code>allow_incompatible_default_type!</code> in your code
You can silence deprecations warning by setting the environment variable THOR<em>SILENCE</em>DEPRECATION.
== Blog Sources: {year}-{month}-{day}-{title}.html (:prefix + :sources)
   identical  build/stylesheets/site-a77c873c.css
   identical  build/images/.keep
   identical  build/javascripts/site-954757c2.js
   identical  build/index.html
Project built successfully.</p>

<h2>Deploying via git to remote=&quot;origin&quot; and branch=&quot;gh-pages&quot;</h2>

<p>Already on &#39;gh-pages&#39;
[gh-pages fb16df1] Automated commit at 2020-07-21 01:06:00 UTC by middleman-deploy 2.0.0-alpha
Username for &#39;<a href="https://github.com&#x27;:">https://github.com&#39;:</a> xuejoule
Password for &#39;<a href="https://xuejoule@github.com&#x27;:">https://xuejoule@github.com&#39;:</a> 
Enumerating objects: 10, done.
Counting objects: 100% (10/10), done.
Delta compression using up to 8 threads
Compressing objects: 100% (5/5), done.
Writing objects: 100% (10/10), 1.63 KiB | 555.00 KiB/s, done.
Total 10 (delta 1), reused 0 (delta 0), pack-reused 0
remote: Resolving deltas: 100% (1/1), done.
remote: 
remote: Create a pull request for &#39;gh-pages&#39; on GitHub by visiting:
remote:      <a href="https://github.com/xuejoule/tanaka_blog/pull/new/gh-pages">https://github.com/xuejoule/tanaka_blog/pull/new/gh-pages</a>
remote: 
To <a href="https://github.com/xuejoule/tanaka_blog.git">https://github.com/xuejoule/tanaka_blog.git</a>
 * [new branch]      gh-pages -&gt; gh-pages</p>

<p>githab pages
<a href="https://github.com/xuejoule/tanaka_blog.git">https://github.com/xuejoule/tanaka_blog.git</a></p>

<p>デプロイしてから10分程度待った後に， https://(ユーザー名).github.io/(リポジトリ名) にアクセスするとサイトができています。</p>

<p>= 完了</p>

<p>= 補足
% bundle exec middleman version
Deprecation warning: Expected string default value for &#39;--instrument&#39;; got false (boolean).
This will be rejected in the future unless you explicitly pass the options <code>check_default_type: false</code> or call <code>allow_incompatible_default_type!</code> in your code
You can silence deprecations warning by setting the environment variable THOR<em>SILENCE</em>DEPRECATION.
Middleman 4.3.7</p>

  </body>
</html>
