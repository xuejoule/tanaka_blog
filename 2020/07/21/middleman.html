<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Rspec学習</title>
    <link href="https://xuejoule.github.io/tanaka_blog/stylesheets/site-3beba0c0.css" rel="stylesheet" />
    <script src="https://xuejoule.github.io/tanaka_blog/javascripts/site-954757c2.js"></script>
  </head>
  <body>
    <h2>modelのテスト</h2>

<h2>正常系と異常系</h2>

<p>filepath: spec/models/contact_spec.rb</p>

<pre><code>require &#39;rspec_helper&#39;

describe Contact do
  it &#39;firstname, lastname, emailがvalid&#39; do
    contact = Contact.new(
      firstname: &quot;tanaka&quot;,
      lastname: &quot;manabu&quot;,
      email: &quot;tanaka@exmple.com&quot;
    )
    expect(contact).to be_valid
  end
  it &#39;firstnameが無い場合invalid&#39; do
    contact = Contact.new(
      firstname: nil,
      lastname: &quot;manabu&quot;,
      email: &quot;tanaka@exmple.com&quot;
    )
    expect(contact).to have(1).error_on(:firstname)
  end
end
</code></pre>

<p>before、context使用する</p>

<pre><code>require &#39;rspec_helper&#39;

describe &#39;validation&#39; do
  before each do
    contact = Contact.new(
      firstname: nil,
      lastname: &quot;manabu&quot;,
      email: &quot;tanaka@exmple.com&quot;
    )
  end
  context &#39;firstname, lastname, emailがvalid&#39; do
    it &#39;is_valid&#39; do
      expect(contact).to be_valid
    end
  end
  context &#39;firstnameがない場合&#39; do
    before each do
      contact.firstname = nil
    end
    it &#39;is_invalid&#39; do
      expect(contact).to have(1).error_on(:firstname)
    end
  end
end
</code></pre>

<p>DRY(重複させない)</p>

<p>describeが親contextが子</p>

<p>親子関係でグルーピングさせる</p>

<p>親で作成したテストデータは子でも使える</p>

<p>beforeでまとめる</p>

<p>親のbeforeで作られたテストデータが呼ばれた後に、子のbeforeが呼ばれ、</p>

<p>contact.firstname = nilがテストデータにセットされる</p>

<p>contactはローカル変数。contextの中のcontactメソッドが見つからないと
エラーになるのでインスタンス変数に変更</p>

<p>修正後</p>

<pre><code>describe &#39;validation&#39; do
  before each do
    @contact = Contact.new(
      firstname: nil,
      lastname: &quot;manabu&quot;,
      email: &quot;tanaka@exmple.com&quot;
    )
  end
  context &#39;firstname, lastname, emailがvalid&#39; do
    it &#39;is_valid&#39; do
      expect(@contact).to be_valid
    end
  end
  context &#39;firstnameがない場合&#39; do
    before each do
      @contact.firstname = nil
    end
    it &#39;is_invalid&#39; do
      expect(@contact).to have(1).error_on(:firstname)
    end
  end
end
</code></pre>

  </body>
</html>
